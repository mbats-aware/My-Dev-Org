name: QA Deployment

on: 
  workflow_dispatch:
    paths:
      - "force-app/main/default/**"

jobs:
  validate:
    # if: github.event.pull_request.merge == true
    runs-on: ubuntu-latest
    environment: QA
    container:
      image: awareservices/sfdx-cli:latest
    steps:
      - name: Authenticating QA Org
        run: |
          echo ${{ secrets.AUTH_URL }} > authURL
          sfdx auth:sfdxurl:store -f authURL -a "QA Org"
      - name: Generating Deployment Package
        run: |
          sfdx force:source:convert -r ".\force-app\main\default\" -d ".\deploy"
      - name: Validating Deployment
        run: |
          sfdx force:source:deploy -p ".\deploy" -c --verbose
